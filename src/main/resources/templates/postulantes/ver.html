<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{fragmentos/pagina-maestra :: html(~{::title}, ~{::section}, ~{::link})}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ver Postulante</title>
    <link rel="stylesheet" th:href="@{/css/crud.css}">
</head>
<section>
    <div id="contenedor">

        <div class="card">
            <h2>Postulante</h2>

            <div th:if="${mensaje}" class="exito" th:text="${mensaje}"></div>
            <div th:if="${error}" class="error" th:text="${error}"></div>

            <form th:action="@{/postulantes/ver}" method="post" th:object="${postulante}" onsubmit="return confirmarEliminar(this)">

                <input type="hidden" th:field="*{usuario}"/>

                <!-- Fotografía opcional -->
                <div th:if="${postulante.tieneImagen}" style="text-align:center; margin-bottom:15px;">
                    <img th:src="@{/imagen/{nombre}.jpeg(nombre=${postulante.cedula})}" 
                        th:alt="${postulante.primerNombre}" 
                        style="width:150px; height:auto; border-radius:5px; border:1px solid #ccc;"/>
                </div>

                <label>Usuario</label>
                <input type="text" th:field="*{usuario}" readonly/>

                <label>Primer Nombre</label>
                <input type="text" th:field="*{primerNombre}" readonly/>

                <label>Segundo Nombre</label>
                <input type="text" th:field="*{segundoNombre}" readonly/>

                <label>Primer Apellido</label>
                <input type="text" th:field="*{primerApellido}" readonly/>

                <label>Segundo Apellido</label>
                <input type="text" th:field="*{segundoApellido}" readonly/>

                <label>Fecha de Nacimiento</label>
                <input type="date" th:field="*{fechanacimiento}" readonly/>

                <label>Departamento</label>
                <input type="text" th:field="*{departamento}" readonly/>

            <div th:if="${fotoDisponible}">
                <label> Foto</label>
                <a id="foto" class="foto" th:href="@{|/foto/${postulante.cedula}.jpeg|}" target="_blank">Ver Foto</a>
            </div>    

            <div th:unless="${fotoDisponible}">
                <label> Foto </label>
                   <span class="error-simple"> Foto no disponible</span>
               
            </div>

            <div th:if="${cvDisponible}" >
            <label>Currículum</label>
            <a id="cv" class="cv" th:href="@{|/pdf/${postulante.cedula}.pdf|}" target="_blank">Ver CV</a> 
            </div>

        <div th:unless="${cvDisponible}">
            <label>Currículum</label>
            <span class="error-simple">CV no disponible</span>
        </div>

                <div style="margin-top:15px;">
                    <button type="submit" name="accion" value="btn_modificar" sec:authorize="hasAnyAuthority('admin','postulante')">Modificar</button>
                    <button type="submit" name="accion" value="btn_eliminar" sec:authorize="hasAnyAuthority('admin','postulante')">Eliminar</button>
                    <!-- <a th:href="@{/postulantes/lista}" sec:authorize="hasAuthority('postulante')"></a> -->
                     <a th:if="${idOferta != null}" th:href="@{/postulaciones/ofertas/{id}/postulantes(id=${idOferta})}" sec:authorize="hasAuthority('cliente')">
                    <button type="button">Volver al listado</button></a>

                    <!-- Si no vino desde una oferta, volver a la lista general -->
                    <a th:if="${idOferta == null}" th:href="@{/postulantes/lista}">
                    <button type="button">Volver</button>
                    </a>

                </div>
 
            </form>
        </div>

        
    </div>
</section>

<script>
function confirmarEliminar(form) {
    const accion = document.activeElement.value;
    if (accion === 'btn_eliminar') {
        return confirm('¿Está seguro que desea eliminar este postulante?');
    }
    return true;
}
</script>
</html>



